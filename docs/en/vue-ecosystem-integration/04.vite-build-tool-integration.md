# Vite Build Tool Integration with Element Plus

## Overview

Vite is the recommended build tool for Vue 3 and Element Plus applications. This guide covers advanced Vite configuration, optimization strategies, and best practices for Element Plus projects.

## Basic Vite Configuration

### Installation and Setup

```bash
# Create new Vite project with Vue template
npm create vite@latest my-element-plus-app -- --template vue-ts
cd my-element-plus-app

# Install dependencies
npm install
npm install element-plus
npm install @element-plus/icons-vue

# Development dependencies
npm install -D @vitejs/plugin-vue
npm install -D vite-plugin-eslint
npm install -D unplugin-vue-components
npm install -D unplugin-auto-import
npm install -D unplugin-element-plus
```

### Basic Vite Configuration

```typescript
// vite.config.ts
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { resolve } from 'path'
import AutoImport from 'unplugin-auto-import/vite'
import Components from 'unplugin-vue-components/vite'
import { ElementPlusResolver } from 'unplugin-vue-components/resolvers'
import ElementPlus from 'unplugin-element-plus/vite'

export default defineConfig({
  plugins: [
    vue(),
    
    // Auto import Element Plus components
    AutoImport({
      resolvers: [ElementPlusResolver()],
      imports: [
        'vue',
        'vue-router',
        'pinia',
        {
          'element-plus': [
            'ElMessage',
            'ElMessageBox',
            'ElNotification',
            'ElLoading'
          ]
        }
      ],
      dts: true,
      eslintrc: {
        enabled: true
      }
    }),
    
    // Auto import Element Plus components
    Components({
      resolvers: [
        ElementPlusResolver({
          importStyle: 'sass'
        })
      ],
      dts: true
    }),
    
    // Element Plus optimization
    ElementPlus({
      useSource: true
    })
  ],
  
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
      '~': resolve(__dirname, 'src'),
      'components': resolve(__dirname, 'src/components'),
      'views': resolve(__dirname, 'src/views'),
      'utils': resolve(__dirname, 'src/utils'),
      'stores': resolve(__dirname, 'src/stores'),
      'assets': resolve(__dirname, 'src/assets')
    }
  },
  
  css: {
    preprocessorOptions: {
      scss: {
        additionalData: `
          @use "@/styles/element/index.scss" as *;
          @use "@/styles/variables.scss" as *;
        `
      }
    }
  },
  
  server: {
    port: 3000,
    open: true,
    cors: true,
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '')
      }
    }
  },
  
  build: {
    target: 'es2015',
    outDir: 'dist',
    assetsDir: 'assets',
    sourcemap: false,
    
    rollupOptions: {
      output: {
        chunkFileNames: 'js/[name]-[hash].js',
        entryFileNames: 'js/[name]-[hash].js',
        assetFileNames: '[ext]/[name]-[hash].[ext]',
        
        manualChunks: {
          'element-plus': ['element-plus'],
          'vue-vendor': ['vue', 'vue-router', 'pinia'],
          'utils': ['lodash-es', 'dayjs']
        }
      }
    },
    
    // Minification options
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,
        drop_debugger: true
      }
    }
  },
  
  optimizeDeps: {
    include: [
      'vue',
      'vue-router',
      'pinia',
      'element-plus/es',
      'element-plus/es/components/*/style/index',
      '@element-plus/icons-vue'
    ]
  }
})
```

## Advanced Configuration

### Environment-Specific Configuration

```typescript
// vite.config.ts
import { defineConfig, loadEnv } from 'vite'
import type { UserConfig } from 'vite'

export default defineConfig(({ command, mode }) => {
  const env = loadEnv(mode, process.cwd(), '')
  
  const config: UserConfig = {
    plugins: [
      // ... plugins
    ],
    
    define: {
      __APP_VERSION__: JSON.stringify(process.env.npm_package_version),
      __BUILD_TIME__: JSON.stringify(new Date().toISOString()),
      __DEV__: command === 'serve'
    }
  }
  
  // Development-specific configuration
  if (command === 'serve') {
    config.server = {
      port: parseInt(env.VITE_PORT) || 3000,
      host: env.VITE_HOST || 'localhost',
      open: env.VITE_OPEN === 'true'
    }
    
    config.css = {
      devSourcemap: true
    }
  }
  
  // Production-specific configuration
  if (command === 'build') {
    config.build = {
      ...config.build,
      reportCompressedSize: false,
      chunkSizeWarningLimit: 1000,
      
      rollupOptions: {
        output: {
          manualChunks: (id) => {
            // Vendor chunks
            if (id.includes('node_modules')) {
              if (id.includes('element-plus')) {
                return 'element-plus'
              }
              if (id.includes('vue') || id.includes('pinia')) {
                return 'vue-vendor'
              }
              if (id.includes('lodash') || id.includes('dayjs')) {
                return 'utils'
              }
              return 'vendor'
            }
            
            // Feature-based chunks
            if (id.includes('/src/views/')) {
              const viewName = id.split('/views/')[1].split('/')[0]
              return `view-${viewName}`
            }
          }
        }
      }
    }
  }
  
  return config
})
```

### Custom Plugins

```typescript
// plugins/vite-plugin-element-plus-theme.ts
import type { Plugin } from 'vite'
import { readFileSync, writeFileSync } from 'fs'
import { resolve } from 'path'

interface ThemeOptions {
  themeFile?: string
  outputFile?: string
  variables?: Record<string, string>
}

export function elementPlusThemePlugin(options: ThemeOptions = {}): Plugin {
  const {
    themeFile = 'src/styles/element/theme.scss',
    outputFile = 'src/styles/element/generated.scss',
    variables = {}
  } = options
  
  return {
    name: 'vite-plugin-element-plus-theme',
    
    buildStart() {
      this.addWatchFile(resolve(themeFile))
    },
    
    handleHotUpdate({ file, server }) {
      if (file.includes(themeFile)) {
        generateTheme()
        server.ws.send({
          type: 'full-reload'
        })
      }
    },
    
    buildEnd() {
      generateTheme()
    }
  }
  
  function generateTheme() {
    try {
      const themeContent = readFileSync(resolve(themeFile), 'utf-8')
      
      // Process theme variables
      let processedContent = themeContent
      
      Object.entries(variables).forEach(([key, value]) => {
        const regex = new RegExp(`\\$${key}:\\s*[^;]+;`, 'g')
        processedContent = processedContent.replace(regex, `$${key}: ${value};`)
      })
      
      // Add Element Plus imports
      const finalContent = `
// Auto-generated theme file
@use "element-plus/theme-chalk/src/index.scss" as *;

${processedContent}
      `
      
      writeFileSync(resolve(outputFile), finalContent)
      console.log('✅ Element Plus theme generated')
    } catch (error) {
      console.error('❌ Failed to generate theme:', error)
    }
  }
}

// Usage in vite.config.ts
import { elementPlusThemePlugin } from './plugins/vite-plugin-element-plus-theme'

export default defineConfig({
  plugins: [
    // ... other plugins
    elementPlusThemePlugin({
      variables: {
        'el-color-primary': '#1890ff',
        'el-border-radius-base': '6px'
      }
    })
  ]
})
```

### Bundle Analysis Plugin

```typescript
// plugins/vite-plugin-bundle-analyzer.ts
import type { Plugin } from 'vite'
import { BundleAnalyzerPlugin } from 'webpack-bundle-analyzer'

interface AnalyzerOptions {
  enabled?: boolean
  openAnalyzer?: boolean
  analyzerMode?: 'server' | 'static' | 'json'
  reportFilename?: string
}

export function bundleAnalyzerPlugin(options: AnalyzerOptions = {}): Plugin {
  const {
    enabled = process.env.ANALYZE === 'true',
    openAnalyzer = true,
    analyzerMode = 'server',
    reportFilename = 'bundle-report.html'
  } = options
  
  return {
    name: 'vite-plugin-bundle-analyzer',
    apply: 'build',
    
    generateBundle(options, bundle) {
      if (!enabled) return
      
      const chunks = Object.values(bundle).filter(
        (chunk): chunk is any => chunk.type === 'chunk'
      )
      
      const assets = chunks.map(chunk => ({
        name: chunk.fileName,
        size: chunk.code.length,
        modules: Object.keys(chunk.modules || {})
      }))
      
      console.log('\n📊 Bundle Analysis:')
      console.table(assets.map(asset => ({
        File: asset.name,
        Size: `${(asset.size / 1024).toFixed(2)} KB`,
        Modules: asset.modules.length
      })))
      
      // Generate detailed report
      if (analyzerMode === 'static') {
        const reportData = {
          timestamp: new Date().toISOString(),
          totalSize: assets.reduce((sum, asset) => sum + asset.size, 0),
          assets: assets
        }
        
        this.emitFile({
          type: 'asset',
          fileName: reportFilename.replace('.html', '.json'),
          source: JSON.stringify(reportData, null, 2)
        })
      }
    }
  }
}
```

## Performance Optimization

### Code Splitting Strategy

```typescript
// src/router/index.ts
import { createRouter, createWebHistory } from 'vue-router'
import type { RouteRecordRaw } from 'vue-router'

// Lazy load components with chunk names
const routes: RouteRecordRaw[] = [
  {
    path: '/',
    name: 'Home',
    component: () => import(/* webpackChunkName: "home" */ '@/views/Home.vue')
  },
  {
    path: '/dashboard',
    name: 'Dashboard',
    component: () => import(/* webpackChunkName: "dashboard" */ '@/views/Dashboard.vue'),
    children: [
      {
        path: 'analytics',
        component: () => import(/* webpackChunkName: "dashboard-analytics" */ '@/views/dashboard/Analytics.vue')
      },
      {
        path: 'reports',
        component: () => import(/* webpackChunkName: "dashboard-reports" */ '@/views/dashboard/Reports.vue')
      }
    ]
  },
  {
    path: '/admin',
    name: 'Admin',
    component: () => import(/* webpackChunkName: "admin" */ '@/views/Admin.vue'),
    meta: { requiresAuth: true, role: 'admin' }
  }
]

// Dynamic route loading based on user permissions
export const loadUserRoutes = async (userRole: string) => {
  const dynamicRoutes: RouteRecordRaw[] = []
  
  if (userRole === 'admin') {
    const adminRoutes = await import(/* webpackChunkName: "admin-routes" */ './admin-routes')
    dynamicRoutes.push(...adminRoutes.default)
  }
  
  if (userRole === 'manager') {
    const managerRoutes = await import(/* webpackChunkName: "manager-routes" */ './manager-routes')
    dynamicRoutes.push(...managerRoutes.default)
  }
  
  return dynamicRoutes
}

const router = createRouter({
  history: createWebHistory(),
  routes
})

export default router
```

### Asset Optimization

```typescript
// vite.config.ts - Asset optimization
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        // Separate CSS files
        assetFileNames: (assetInfo) => {
          const info = assetInfo.name.split('.')
          const ext = info[info.length - 1]
          
          if (/\.(png|jpe?g|svg|gif|tiff|bmp|ico)$/i.test(assetInfo.name)) {
            return `images/[name]-[hash].${ext}`
          }
          
          if (/\.(woff2?|eot|ttf|otf)$/i.test(assetInfo.name)) {
            return `fonts/[name]-[hash].${ext}`
          }
          
          if (ext === 'css') {
            return `css/[name]-[hash].${ext}`
          }
          
          return `assets/[name]-[hash].${ext}`
        }
      }
    }
  },
  
  // Image optimization
  assetsInclude: ['**/*.svg', '**/*.png', '**/*.jpg', '**/*.jpeg', '**/*.gif'],
  
  // CSS optimization
  css: {
    postcss: {
      plugins: [
        require('autoprefixer'),
        require('cssnano')({
          preset: 'default'
        })
      ]
    }
  }
})
```

### Tree Shaking Configuration

```typescript
// src/utils/element-plus.ts - Optimized Element Plus imports
import type { App } from 'vue'

// Import only needed components
import {
  ElButton,
  ElInput,
  ElForm,
  ElFormItem,
  ElCard,
  ElTable,
  ElTableColumn,
  ElPagination,
  ElDialog,
  ElMessage,
  ElMessageBox,
  ElNotification,
  ElLoading
} from 'element-plus'

// Import only needed icons
import {
  Search,
  Edit,
  Delete,
  Plus,
  Download,
  Upload
} from '@element-plus/icons-vue'

const components = [
  ElButton,
  ElInput,
  ElForm,
  ElFormItem,
  ElCard,
  ElTable,
  ElTableColumn,
  ElPagination,
  ElDialog
]

const icons = {
  Search,
  Edit,
  Delete,
  Plus,
  Download,
  Upload
}

export function setupElementPlus(app: App) {
  // Register components
  components.forEach(component => {
    app.component(component.name, component)
  })
  
  // Register icons
  Object.entries(icons).forEach(([name, icon]) => {
    app.component(name, icon)
  })
  
  // Global properties
  app.config.globalProperties.$message = ElMessage
  app.config.globalProperties.$msgbox = ElMessageBox
  app.config.globalProperties.$alert = ElMessageBox.alert
  app.config.globalProperties.$confirm = ElMessageBox.confirm
  app.config.globalProperties.$prompt = ElMessageBox.prompt
  app.config.globalProperties.$notify = ElNotification
  app.config.globalProperties.$loading = ElLoading.service
}
```

## Development Tools Integration

### ESLint and Prettier Configuration

```javascript
// .eslintrc.js
module.exports = {
  root: true,
  env: {
    node: true,
    browser: true,
    es2021: true
  },
  extends: [
    'eslint:recommended',
    '@vue/eslint-config-typescript',
    '@vue/eslint-config-prettier',
    'plugin:vue/vue3-recommended'
  ],
  parserOptions: {
    ecmaVersion: 2021,
    sourceType: 'module'
  },
  rules: {
    'vue/multi-word-component-names': 'off',
    'vue/no-unused-vars': 'error',
    '@typescript-eslint/no-unused-vars': 'error',
    'prefer-const': 'error',
    'no-console': process.env.NODE_ENV === 'production' ? 'warn' : 'off',
    'no-debugger': process.env.NODE_ENV === 'production' ? 'warn' : 'off'
  },
  globals: {
    ElMessage: 'readonly',
    ElMessageBox: 'readonly',
    ElNotification: 'readonly',
    ElLoading: 'readonly'
  }
}
```

```json
// .prettierrc
{
  "semi": false,
  "singleQuote": true,
  "tabWidth": 2,
  "trailingComma": "none",
  "printWidth": 100,
  "bracketSpacing": true,
  "arrowParens": "avoid",
  "vueIndentScriptAndStyle": false
}
```

### TypeScript Configuration

```json
// tsconfig.json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "preserve",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"],
      "~/*": ["src/*"],
      "components/*": ["src/components/*"],
      "views/*": ["src/views/*"],
      "utils/*": ["src/utils/*"],
      "stores/*": ["src/stores/*"],
      "assets/*": ["src/assets/*"]
    },
    "types": [
      "vite/client",
      "element-plus/global"
    ]
  },
  "include": [
    "src/**/*.ts",
    "src/**/*.d.ts",
    "src/**/*.tsx",
    "src/**/*.vue",
    "auto-imports.d.ts",
    "components.d.ts"
  ],
  "references": [
    {
      "path": "./tsconfig.node.json"
    }
  ]
}
```

### Vitest Testing Configuration

```typescript
// vitest.config.ts
import { defineConfig } from 'vitest/config'
import vue from '@vitejs/plugin-vue'
import { resolve } from 'path'

export default defineConfig({
  plugins: [vue()],
  
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: ['./src/test/setup.ts'],
    
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
      exclude: [
        'node_modules/',
        'src/test/',
        '**/*.d.ts',
        '**/*.config.*',
        'dist/'
      ]
    }
  },
  
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
      '~': resolve(__dirname, 'src')
    }
  }
})
```

```typescript
// src/test/setup.ts
import { config } from '@vue/test-utils'
import ElementPlus from 'element-plus'

// Global test setup
config.global.plugins = [ElementPlus]

// Mock Element Plus message services
const mockMessage = {
  success: vi.fn(),
  error: vi.fn(),
  warning: vi.fn(),
  info: vi.fn()
}

const mockMessageBox = {
  alert: vi.fn(),
  confirm: vi.fn().mockResolvedValue('confirm'),
  prompt: vi.fn().mockResolvedValue({ value: 'test' })
}

const mockNotification = {
  success: vi.fn(),
  error: vi.fn(),
  warning: vi.fn(),
  info: vi.fn()
}

config.global.mocks = {
  $message: mockMessage,
  $msgbox: mockMessageBox,
  $notify: mockNotification
}

// Mock window.matchMedia
Object.defineProperty(window, 'matchMedia', {
  writable: true,
  value: vi.fn().mockImplementation(query => ({
    matches: false,
    media: query,
    onchange: null,
    addListener: vi.fn(),
    removeListener: vi.fn(),
    addEventListener: vi.fn(),
    removeEventListener: vi.fn(),
    dispatchEvent: vi.fn()
  }))
})
```

## Deployment Configuration

### Multi-Environment Build

```typescript
// scripts/build.ts
import { build } from 'vite'
import { resolve } from 'path'
import type { InlineConfig } from 'vite'

interface BuildOptions {
  mode: 'development' | 'staging' | 'production'
  analyze?: boolean
  sourcemap?: boolean
}

async function buildApp(options: BuildOptions) {
  const { mode, analyze = false, sourcemap = false } = options
  
  const config: InlineConfig = {
    mode,
    configFile: resolve(__dirname, '../vite.config.ts'),
    
    build: {
      sourcemap,
      outDir: `dist-${mode}`,
      
      rollupOptions: {
        external: mode === 'development' ? [] : ['vue', 'vue-router'],
        
        output: {
          globals: mode === 'development' ? {} : {
            vue: 'Vue',
            'vue-router': 'VueRouter'
          }
        }
      }
    },
    
    define: {
      __MODE__: JSON.stringify(mode),
      __BUILD_TIME__: JSON.stringify(new Date().toISOString())
    }
  }
  
  if (analyze) {
    // Add bundle analyzer
    config.plugins = [
      ...(config.plugins || []),
      // bundleAnalyzerPlugin()
    ]
  }
  
  try {
    await build(config)
    console.log(`✅ Build completed for ${mode} mode`)
  } catch (error) {
    console.error(`❌ Build failed for ${mode} mode:`, error)
    process.exit(1)
  }
}

// CLI interface
const args = process.argv.slice(2)
const mode = (args[0] as BuildOptions['mode']) || 'production'
const analyze = args.includes('--analyze')
const sourcemap = args.includes('--sourcemap')

buildApp({ mode, analyze, sourcemap })
```

### Docker Integration

```dockerfile
# Dockerfile
FROM node:18-alpine as build-stage

WORKDIR /app

# Copy package files
COPY package*.json ./
RUN npm ci --only=production

# Copy source code
COPY . .

# Build application
RUN npm run build

# Production stage
FROM nginx:alpine as production-stage

# Copy built assets
COPY --from=build-stage /app/dist /usr/share/nginx/html

# Copy nginx configuration
COPY nginx.conf /etc/nginx/nginx.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
```

```nginx
# nginx.conf
events {
    worker_connections 1024;
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;
    
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json;
    
    server {
        listen 80;
        server_name localhost;
        
        root /usr/share/nginx/html;
        index index.html;
        
        # Handle client-side routing
        location / {
            try_files $uri $uri/ /index.html;
        }
        
        # Cache static assets
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
        
        # Security headers
        add_header X-Frame-Options "SAMEORIGIN" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header X-XSS-Protection "1; mode=block" always;
        add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    }
}
```

This comprehensive guide covers advanced Vite configuration for Element Plus applications, including performance optimization, development tools integration, and deployment strategies. The examples provide practical implementations for building scalable and efficient Vue 3 applications with Element Plus.